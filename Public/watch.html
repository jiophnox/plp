<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watch - YouTube</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #0f0f0f;
      color: #fff;
      min-height: 100vh;
    }

    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #333;
      border-top-color: #ff0000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .spinner.small {
      width: 24px;
      height: 24px;
      border-width: 3px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Header */
    .header {
      background: #0f0f0f;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid #272727;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .menu-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .menu-btn:hover {
      background: #272727;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 2px;
      text-decoration: none;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .logo-icon {
      width: 28px;
      height: 20px;
      background: #ff0000;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    /* Search Bar */
    .search-container {
      flex: 1;
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }

    .search-bar {
      display: flex;
      width: 100%;
    }

    .search-input {
      flex: 1;
      padding: 10px 16px;
      background: #121212;
      border: 1px solid #333;
      border-right: none;
      border-radius: 20px 0 0 20px;
      color: #fff;
      font-size: 14px;
      outline: none;
    }

    .search-input:focus {
      border-color: #3ea6ff;
    }

    .search-input::placeholder {
      color: #888;
    }

    .search-btn {
      padding: 0 24px;
      background: #222;
      border: 1px solid #333;
      border-radius: 0 20px 20px 0;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .search-btn:hover {
      background: #333;
    }

    .voice-btn {
      background: #272727;
      border: none;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-left: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    .voice-btn:hover {
      background: #3f3f3f;
    }

    /* Search Suggestions */
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 48px;
      background: #212121;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 1000;
      overflow: hidden;
    }

    .suggestion-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .suggestion-item:hover {
      background: #333;
    }

    .suggestion-icon {
      color: #aaa;
      font-size: 14px;
    }

    .suggestion-text {
      flex: 1;
      font-size: 14px;
    }

    .suggestion-type {
      font-size: 12px;
      color: #3ea6ff;
      background: rgba(62, 166, 255, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
    }

    /* Search Loading */
    .search-loading {
      padding: 20px;
      text-align: center;
      color: #aaa;
    }

    /* Header Right */
    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-btn {
      background: none;
      border: none;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-btn:hover {
      background: #272727;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #7c4dff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
    }

    /* Main Layout */
    .main-container {
      display: flex;
      max-width: 1800px;
      margin: 0 auto;
      padding: 24px;
      gap: 24px;
    }

    /* Video Player Section */
    .player-section {
      flex: 1;
      min-width: 0;
    }

    .video-player-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }

    .video-player-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Player Placeholder */
    .player-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #aaa;
      text-align: center;
      padding: 40px;
    }

    .player-placeholder-icon {
      font-size: 64px;
      margin-bottom: 24px;
      opacity: 0.5;
    }

    .player-placeholder h2 {
      font-size: 24px;
      color: #fff;
      margin-bottom: 12px;
    }

    .player-placeholder p {
      font-size: 14px;
      max-width: 400px;
      line-height: 1.6;
    }

    /* Video Info */
    .video-info {
      padding: 16px 0;
    }

    .video-title {
      font-size: 20px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .video-stats {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }

    .video-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #aaa;
      font-size: 14px;
    }

    .video-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .action-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #272727;
      border: none;
      border-radius: 20px;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .action-btn:hover {
      background: #3f3f3f;
    }

    .action-btn.liked {
      background: #3ea6ff;
      color: #000;
    }

    .action-btn.active {
      background: #fff;
      color: #000;
    }

    /* Channel Info */
    .channel-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid #272727;
      flex-wrap: wrap;
      gap: 12px;
    }

    .channel-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .channel-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #333;
      object-fit: cover;
    }

    .channel-details h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .channel-details h3 a {
      color: #fff;
      text-decoration: none;
    }

    .channel-details h3 a:hover {
      color: #3ea6ff;
    }

    .channel-subs {
      font-size: 12px;
      color: #aaa;
    }

    .channel-buttons {
      display: flex;
      gap: 8px;
    }

    .subscribe-btn {
      padding: 10px 20px;
      background: #fff;
      color: #0f0f0f;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .subscribe-btn:hover {
      background: #d9d9d9;
    }

    .subscribe-btn.subscribed {
      background: #272727;
      color: #fff;
    }

    .join-btn {
      padding: 10px 20px;
      background: transparent;
      color: #3ea6ff;
      border: 1px solid #3ea6ff;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .join-btn:hover {
      background: rgba(62, 166, 255, 0.1);
    }

    /* Description */
    .description-box {
      background: #272727;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .description-box:hover {
      background: #3f3f3f;
    }

    .description-box.expanded {
      cursor: default;
    }

    .description-box.expanded:hover {
      background: #272727;
    }

    .description-meta {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .description-text {
      font-size: 14px;
      line-height: 1.6;
      color: #f1f1f1;
      white-space: pre-wrap;
    }

    .description-text:not(.expanded) {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .description-text.expanded {
      -webkit-line-clamp: unset;
    }

    .show-more-btn {
      background: none;
      border: none;
      color: #aaa;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin-top: 12px;
      padding: 0;
    }

    .show-more-btn:hover {
      color: #fff;
    }

    /* Sidebar */
    .sidebar {
      width: 400px;
      flex-shrink: 0;
    }

    /* Playlist Panel */
    .playlist-panel {
      background: #181818;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .playlist-header {
      background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
      padding: 16px;
    }

    .playlist-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .playlist-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      color: #aaa;
      margin-bottom: 4px;
    }

    .playlist-author a {
      color: #aaa;
      text-decoration: none;
    }

    .playlist-author a:hover {
      color: #fff;
    }

    .playlist-progress {
      color: #fff;
      font-weight: 500;
    }

    .playlist-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .control-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #aaa;
    }

    .control-toggle {
      position: relative;
      width: 36px;
      height: 20px;
      background: #717171;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .control-toggle.active {
      background: #3ea6ff;
    }

    .control-toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transition: left 0.2s;
    }

    .control-toggle.active::after {
      left: 18px;
    }

    .shuffle-btn, .loop-btn {
      background: none;
      border: none;
      color: #aaa;
      font-size: 18px;
      cursor: pointer;
      padding: 4px;
    }

    .shuffle-btn:hover, .loop-btn:hover {
      color: #fff;
    }

    .shuffle-btn.active, .loop-btn.active {
      color: #3ea6ff;
    }

    /* Playlist Videos */
    .playlist-videos {
      max-height: calc(100vh - 400px);
      overflow-y: auto;
    }

    .playlist-videos::-webkit-scrollbar {
      width: 8px;
    }

    .playlist-videos::-webkit-scrollbar-track {
      background: #181818;
    }

    .playlist-videos::-webkit-scrollbar-thumb {
      background: #3f3f3f;
      border-radius: 4px;
    }

    .playlist-video-item {
      display: flex;
      gap: 8px;
      padding: 8px 12px;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      transition: background 0.2s;
      border-left: 3px solid transparent;
    }

    .playlist-video-item:hover {
      background: #272727;
    }

    .playlist-video-item.active {
      background: #272727;
      border-left-color: #3ea6ff;
    }

    .video-index {
      width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #aaa;
      flex-shrink: 0;
    }

    .video-index.playing {
      color: #3ea6ff;
    }

    .playlist-video-thumb {
      position: relative;
      width: 100px;
      aspect-ratio: 16/9;
      border-radius: 8px;
      overflow: hidden;
      background: #333;
      flex-shrink: 0;
    }

    .playlist-video-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .playlist-video-duration {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 11px;
    }

    .playlist-video-info {
      flex: 1;
      min-width: 0;
    }

    .playlist-video-title {
      font-size: 13px;
      font-weight: 500;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 4px;
      color: #f1f1f1;
    }

    .playlist-video-author {
      font-size: 12px;
      color: #aaa;
    }

    /* Quick Actions Bar */
    .quick-actions {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: #272727;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .quick-action-btn {
      flex: 1;
      padding: 10px;
      background: #3f3f3f;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: background 0.2s;
    }

    .quick-action-btn:hover {
      background: #555;
    }

    .quick-action-btn span:first-child {
      font-size: 18px;
    }

    /* Autoplay Overlay */
    .autoplay-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .autoplay-content {
      text-align: center;
      max-width: 400px;
      padding: 24px;
    }

    .autoplay-label {
      font-size: 12px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 16px;
    }

    .autoplay-next-video {
      display: flex;
      gap: 12px;
      background: #272727;
      border-radius: 12px;
      padding: 12px;
      text-align: left;
      margin-bottom: 20px;
    }

    .autoplay-thumb {
      width: 120px;
      aspect-ratio: 16/9;
      border-radius: 8px;
      overflow: hidden;
      background: #333;
      flex-shrink: 0;
    }

    .autoplay-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .autoplay-info {
      flex: 1;
      min-width: 0;
    }

    .autoplay-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .autoplay-author {
      font-size: 12px;
      color: #aaa;
    }

    .autoplay-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }

    .countdown-ring {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .countdown-ring svg {
      transform: rotate(-90deg);
    }

    .countdown-ring circle {
      fill: none;
      stroke-width: 4;
    }

    .countdown-ring .bg {
      stroke: #333;
    }

    .countdown-ring .progress {
      stroke: #3ea6ff;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s linear;
    }

    .countdown-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      font-weight: 600;
    }

    .autoplay-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    .play-now-btn {
      background: #fff;
      color: #000;
    }

    .play-now-btn:hover {
      background: #d9d9d9;
    }

    .cancel-btn {
      background: #272727;
      color: #fff;
    }

    .cancel-btn:hover {
      background: #3f3f3f;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #323232;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      transition: transform 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    .toast-action {
      color: #3ea6ff;
      background: none;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #aaa;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 18px;
      color: #fff;
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 14px;
      max-width: 300px;
      margin: 0 auto;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .sidebar {
        width: 350px;
      }
    }

    @media (max-width: 1000px) {
      .main-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .playlist-videos {
        max-height: 400px;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 8px 12px;
        gap: 8px;
      }

      .logo span:last-child {
        display: none;
      }

      .search-container {
        flex: 1;
      }

      .voice-btn {
        display: none;
      }

      .header-right {
        gap: 4px;
      }

      .header-btn {
        width: 36px;
        height: 36px;
      }

      .main-container {
        padding: 12px;
        gap: 16px;
      }

      .video-title {
        font-size: 16px;
      }

      .video-stats {
        flex-direction: column;
        align-items: flex-start;
      }

      .video-actions {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 8px;
      }

      .channel-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .channel-buttons {
        width: 100%;
      }

      .subscribe-btn {
        flex: 1;
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Loading State -->
  <div id="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Main Content -->
  <div id="content" class="hidden">
    <!-- Header -->
    <header class="header">
      <button class="menu-btn">‚ò∞</button>
      <a href="/" class="logo">
        <span class="logo-icon">‚ñ∂</span>
        <span>YouTube</span>
      </a>
      
      <div class="search-container">
        <div class="search-bar">
          <input type="text" class="search-input" id="search-input" placeholder="Search or paste playlist URL/ID">
          <button class="search-btn" id="search-btn">üîç</button>
        </div>
        <button class="voice-btn">üé§</button>
        
        <!-- Search Suggestions -->
        <div class="search-suggestions hidden" id="search-suggestions"></div>
      </div>
      
      <div class="header-right">
        <button class="header-btn" title="Create">‚ûï</button>
        <button class="header-btn" title="Notifications">üîî</button>
        <div class="avatar">Y</div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Player Section -->
      <div class="player-section">
        <div class="video-player-container" id="player-container">
          <!-- Player Placeholder (shown when no video) -->
          <div class="player-placeholder" id="player-placeholder">
            <div class="player-placeholder-icon">üé¨</div>
            <h2>Ready to watch?</h2>
            <p>Search for a video or paste a YouTube playlist URL/ID in the search bar to get started.</p>
          </div>
          <div id="player"></div>
          
          <!-- Autoplay Overlay -->
          <div class="autoplay-overlay hidden" id="autoplay-overlay">
            <div class="autoplay-content">
              <p class="autoplay-label">Up Next</p>
              <div class="autoplay-next-video">
                <div class="autoplay-thumb">
                  <img id="autoplay-thumb" src="" alt="">
                </div>
                <div class="autoplay-info">
                  <h4 class="autoplay-title" id="autoplay-title"></h4>
                  <p class="autoplay-author" id="autoplay-author"></p>
                </div>
              </div>
              <div class="autoplay-controls">
                <div class="countdown-ring">
                  <svg width="60" height="60">
                    <circle class="bg" cx="30" cy="30" r="26"></circle>
                    <circle class="progress" id="countdown-progress" cx="30" cy="30" r="26" 
                      stroke-dasharray="163.36" stroke-dashoffset="0"></circle>
                  </svg>
                  <span class="countdown-number" id="countdown-number">5</span>
                </div>
                <button class="autoplay-btn play-now-btn" id="play-now-btn">Play Now</button>
                <button class="autoplay-btn cancel-btn" id="cancel-autoplay-btn">Cancel</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Video Info -->
        <div class="video-info" id="video-info-section">
          <h1 class="video-title" id="video-title">Select a video to play</h1>
          <div class="video-stats">
            <div class="video-meta">
              <span id="video-views"></span>
              <span id="video-date"></span>
            </div>
            <div class="video-actions">
              <button class="action-btn" id="like-btn">
                <span>üëç</span>
                <span id="like-count">Like</span>
              </button>
              <button class="action-btn" id="dislike-btn">
                <span>üëé</span>
                <span>Dislike</span>
              </button>
              <button class="action-btn" id="share-btn">
                <span>‚ÜóÔ∏è</span>
                <span>Share</span>
              </button>
              <button class="action-btn" id="save-btn">
                <span>üì•</span>
                <span>Save</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Channel Info -->
        <div class="channel-row" id="channel-row">
          <div class="channel-info">
            <img class="channel-avatar" id="channel-avatar" src="" alt="Channel">
            <div class="channel-details">
              <h3><a id="channel-name" href="#">Channel Name</a></h3>
              <p class="channel-subs" id="channel-subs"></p>
            </div>
          </div>
          <div class="channel-buttons">
            <button class="subscribe-btn" id="subscribe-btn">Subscribe</button>
          </div>
        </div>

        <!-- Description -->
        <div class="description-box" id="description-box">
          <div class="description-meta">
            <span id="desc-views"></span> <span id="desc-date"></span>
          </div>
          <p class="description-text" id="video-description"></p>
          <button class="show-more-btn hidden" id="desc-toggle">Show more</button>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar" id="sidebar">
        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="quick-action-btn" id="paste-playlist-btn">
            <span>üìã</span>
            <span>Paste Playlist</span>
          </button>
          <button class="quick-action-btn" id="clear-playlist-btn">
            <span>üóëÔ∏è</span>
            <span>Clear</span>
          </button>
          <button class="quick-action-btn" id="shuffle-all-btn">
            <span>üîÄ</span>
            <span>Shuffle</span>
          </button>
        </div>

        <!-- Playlist Panel -->
        <div class="playlist-panel hidden" id="playlist-panel">
          <div class="playlist-header">
            <h2 class="playlist-title" id="playlist-title"></h2>
            <div class="playlist-info">
              <span class="playlist-author" id="playlist-author"></span>
              <span class="playlist-progress" id="playlist-progress"></span>
            </div>
            <div class="playlist-controls">
              <button class="shuffle-btn" id="shuffle-btn" title="Shuffle">üîÄ</button>
              <div class="control-item">
                <span>Loop</span>
                <div class="control-toggle" id="loop-toggle"></div>
              </div>
              <div class="control-item">
                <span>Autoplay</span>
                <div class="control-toggle active" id="autoplay-toggle"></div>
              </div>
            </div>
          </div>
          <div class="playlist-videos" id="playlist-videos"></div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="empty-state">
          <div class="empty-state-icon">üìù</div>
          <h3>No playlist loaded</h3>
          <p>Search or paste a YouTube playlist URL to load videos here.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <span id="toast-message"></span>
    <button class="toast-action hidden" id="toast-action"></button>
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  
  <script>
    const API_BASE = 'https://plp-s5su.onrender.com/api/channel';

    // State
    let player = null;
    let playerReady = false;
    let currentVideoId = null;
    let currentPlaylistId = null;
    let playlistData = null;
    let currentPlaylistIndex = 0;
    let autoplayEnabled = true;
    let loopEnabled = false;
    let shuffleEnabled = false;
    let shuffledOrder = [];
    let countdownInterval = null;
    let countdownSeconds = 3;

    // Get URL parameters
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        videoId: params.get('v'),
        playlistId: params.get('list'),
        index: parseInt(params.get('index')) || 0
      };
    }

    // Update URL
    function updateURL(videoId, playlistId = null, index = null) {
      let url = `/watch?v=${videoId}`;
      if (playlistId) {
        url += `&list=${playlistId}`;
        if (index !== null && index > 0) {
          url += `&index=${index}`;
        }
      }
      window.history.pushState({}, '', url);
    }

    // Fix thumbnail URLs
    function fixThumbnailUrl(url) {
      if (!url) return 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 9"><rect fill="%23333" width="16" height="9"/></svg>';
      if (url.startsWith('//')) return 'https:' + url;
      return url;
    }

    // Escape HTML
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Show toast notification
    function showToast(message, action = null, actionText = null) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastAction = document.getElementById('toast-action');
      
      toastMessage.textContent = message;
      
      if (action && actionText) {
        toastAction.textContent = actionText;
        toastAction.classList.remove('hidden');
        toastAction.onclick = action;
      } else {
        toastAction.classList.add('hidden');
      }
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 4000);
    }

    // Extract playlist ID from URL or ID
    function extractPlaylistId(input) {
      if (!input) return null;
      
      input = input.trim();
      
      // Direct playlist ID (starts with PL, OL, etc.)
      if (/^[A-Za-z0-9_-]{10,}$/.test(input) && !input.includes('/')) {
        return input;
      }
      
      // YouTube URL patterns
      const patterns = [
        /[?&]list=([A-Za-z0-9_-]+)/,
        /youtube\.com\/playlist\?list=([A-Za-z0-9_-]+)/,
        /youtu\.be\/.*[?&]list=([A-Za-z0-9_-]+)/
      ];
      
      for (const pattern of patterns) {
        const match = input.match(pattern);
        if (match) return match[1];
      }
      
      return null;
    }

    // Extract video ID from URL
    function extractVideoId(input) {
      if (!input) return null;
      
      input = input.trim();
      
      // Direct video ID
      if (/^[A-Za-z0-9_-]{11}$/.test(input)) {
        return input;
      }
      
      // YouTube URL patterns
      const patterns = [
        /[?&]v=([A-Za-z0-9_-]{11})/,
        /youtu\.be\/([A-Za-z0-9_-]{11})/,
        /youtube\.com\/embed\/([A-Za-z0-9_-]{11})/,
        /youtube\.com\/shorts\/([A-Za-z0-9_-]{11})/
      ];
      
      for (const pattern of patterns) {
        const match = input.match(pattern);
        if (match) return match[1];
      }
      
      return null;
    }

    // YouTube Player API Ready
    function onYouTubeIframeAPIReady() {
      playerReady = true;
      
      const params = getUrlParams();
      
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('content').classList.remove('hidden');
      
      if (params.videoId) {
        initPlayer(params.videoId);
        loadVideoData(params.videoId);
        
        if (params.playlistId) {
          loadPlaylist(params.playlistId, params.index);
        }
      } else if (params.playlistId) {
        loadPlaylist(params.playlistId, 0, true);
      }
    }

    // Initialize YouTube Player
    function initPlayer(videoId) {
      document.getElementById('player-placeholder').classList.add('hidden');
      
      if (player) {
        player.loadVideoById(videoId);
        return;
      }
      
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: videoId,
        playerVars: {
          'autoplay': 1,
          'rel': 0,
          'modestbranding': 1,
          'playsinline': 1,
          'enablejsapi': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange,
          'onError': onPlayerError
        }
      });
    }

    // Player ready
    function onPlayerReady(event) {
      event.target.playVideo();
    }

    // Player state change
    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        handleVideoEnded();
      }
      
      if (event.data === YT.PlayerState.PLAYING) {
        cancelAutoplayCountdown();
      }
    }

    // Player error
    function onPlayerError(event) {
      console.error('Player error:', event.data);
      showToast('Error playing video. Trying next...', null, null);
      
      // Try next video if in playlist
      if (playlistData && autoplayEnabled) {
        setTimeout(() => {
          playNextVideo();
        }, 2000);
      }
    }

    // Handle video ended
    function handleVideoEnded() {
      if (!autoplayEnabled || !playlistData) return;
      
      const nextIndex = getNextVideoIndex();
      
      if (nextIndex !== null) {
        startAutoplayCountdown(nextIndex);
      } else {
        showToast('Playlist ended');
      }
    }

    // Get next video index
    function getNextVideoIndex() {
      if (!playlistData || !playlistData.videos) return null;
      
      const order = shuffleEnabled ? shuffledOrder : [...Array(playlistData.videos.length).keys()];
      const currentOrderIndex = order.indexOf(currentPlaylistIndex);
      const nextOrderIndex = currentOrderIndex + 1;
      
      if (nextOrderIndex < order.length) {
        return order[nextOrderIndex];
      } else if (loopEnabled) {
        return order[0];
      }
      
      return null;
    }

    // Start autoplay countdown
    function startAutoplayCountdown(nextIndex) {
      const nextVideo = playlistData.videos[nextIndex];
      if (!nextVideo) return;
      
      document.getElementById('autoplay-thumb').src = fixThumbnailUrl(nextVideo.img || nextVideo.thumbnail);
      document.getElementById('autoplay-title').textContent = nextVideo.title;
      document.getElementById('autoplay-author').textContent = nextVideo.author || playlistData.author || '';
      document.getElementById('autoplay-overlay').classList.remove('hidden');
      
      countdownSeconds = 5;
      updateCountdown();
      
      countdownInterval = setInterval(() => {
        countdownSeconds--;
        updateCountdown();
        
        if (countdownSeconds <= 0) {
          cancelAutoplayCountdown();
          playVideoFromPlaylist(nextIndex);
        }
      }, 1000);
    }

    // Update countdown display
    function updateCountdown() {
      document.getElementById('countdown-number').textContent = countdownSeconds;
      const progress = document.getElementById('countdown-progress');
      const circumference = 163.36;
      const offset = circumference - (countdownSeconds / 5) * circumference;
      progress.style.strokeDashoffset = offset;
    }

    // Cancel autoplay countdown
    function cancelAutoplayCountdown() {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      document.getElementById('autoplay-overlay').classList.add('hidden');
    }

    // Play next video
    function playNextVideo() {
      const nextIndex = getNextVideoIndex();
      if (nextIndex !== null) {
        playVideoFromPlaylist(nextIndex);
      }
    }

    // Load video data
    async function loadVideoData(videoId) {
      currentVideoId = videoId;
      
      try {
        const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
        const data = await response.json();
        
        document.getElementById('video-title').textContent = data.title || 'Video';
        document.getElementById('channel-name').textContent = data.author_name || 'Channel';
        document.getElementById('channel-name').href = data.author_url || '#';
        document.getElementById('channel-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(data.author_name || 'C')}&background=ff0000&color=fff&size=48`;
        
        document.title = `${data.title} - YouTube`;
        
      } catch (error) {
        console.error('Error loading video data:', error);
      }
    }

    // Load playlist
    async function loadPlaylist(playlistId, startIndex = 0, autoPlayFirst = false) {
      currentPlaylistId = playlistId;
      
      showToast('Loading playlist...');
      
      try {
        const response = await fetch(`${API_BASE}/playlist/${playlistId}`);
        const data = await response.json();
        
        if (data && data.videos && data.videos.length > 0) {
          playlistData = data;
          shuffledOrder = [...Array(data.videos.length).keys()];
          
          // Show playlist panel
          document.getElementById('empty-state').classList.add('hidden');
          document.getElementById('playlist-panel').classList.remove('hidden');
          
          // Update header
          document.getElementById('playlist-title').textContent = data.title || 'Playlist';
          document.getElementById('playlist-author').innerHTML = data.author ? 
            `<a href="/@${data.author}">${escapeHtml(data.author)}</a>` : '';
          
          // Render videos
          renderPlaylistVideos();
          
          // Find and set current index
          if (currentVideoId) {
            const idx = data.videos.findIndex(v => v.id === currentVideoId);
            if (idx !== -1) {
              currentPlaylistIndex = idx;
            }
          } else {
            currentPlaylistIndex = startIndex;
          }
          
          updatePlaylistProgress();
          highlightCurrentVideo();
          
          // Auto play first video if requested
          if (autoPlayFirst) {
            playVideoFromPlaylist(currentPlaylistIndex);
          }
          
          showToast(`Loaded ${data.videos.length} videos`);
        } else {
          showToast('Playlist not found or empty');
        }
      } catch (error) {
        console.error('Error loading playlist:', error);
        showToast('Failed to load playlist');
      }
    }

    // Render playlist videos
    function renderPlaylistVideos() {
      const container = document.getElementById('playlist-videos');
      container.innerHTML = '';
      
      const order = shuffleEnabled ? shuffledOrder : [...Array(playlistData.videos.length).keys()];
      
      order.forEach((videoIndex, displayIndex) => {
        const video = playlistData.videos[videoIndex];
        const item = document.createElement('div');
        item.className = 'playlist-video-item' + (videoIndex === currentPlaylistIndex ? ' active' : '');
        item.dataset.index = videoIndex;
        
        item.onclick = () => playVideoFromPlaylist(videoIndex);
        
        item.innerHTML = `
          <div class="video-index ${videoIndex === currentPlaylistIndex ? 'playing' : ''}">
            ${videoIndex === currentPlaylistIndex ? '‚ñ∂' : displayIndex + 1}
          </div>
          <div class="playlist-video-thumb">
            <img src="${fixThumbnailUrl(video.img || video.thumbnail)}" alt="" loading="lazy">
            ${video.duration ? `<span class="playlist-video-duration">${video.duration}</span>` : ''}
          </div>
          <div class="playlist-video-info">
            <h4 class="playlist-video-title">${escapeHtml(video.title)}</h4>
            <p class="playlist-video-author">${escapeHtml(video.author || playlistData.author || '')}</p>
          </div>
        `;
        
        container.appendChild(item);
      });
    }

    // Play video from playlist
    function playVideoFromPlaylist(index) {
      if (!playlistData || !playlistData.videos[index]) return;
      
      cancelAutoplayCountdown();
      
      const video = playlistData.videos[index];
      currentPlaylistIndex = index;
      currentVideoId = video.id;
      
      updateURL(video.id, currentPlaylistId, index);
      
      if (player && typeof player.loadVideoById === 'function') {
        player.loadVideoById(video.id);
      } else {
        initPlayer(video.id);
      }
      
      // Update video info
      document.getElementById('video-title').textContent = video.title;
      document.getElementById('channel-name').textContent = video.author || playlistData.author || 'Channel';
      document.title = `${video.title} - YouTube`;
      
      updatePlaylistProgress();
      highlightCurrentVideo();
      scrollToCurrentVideo();
    }

    // Update playlist progress
    function updatePlaylistProgress() {
      if (playlistData) {
        document.getElementById('playlist-progress').textContent = 
          `${currentPlaylistIndex + 1} / ${playlistData.videos.length}`;
      }
    }

    // Highlight current video
    function highlightCurrentVideo() {
      const items = document.querySelectorAll('.playlist-video-item');
      items.forEach(item => {
        const idx = parseInt(item.dataset.index);
        const isActive = idx === currentPlaylistIndex;
        item.classList.toggle('active', isActive);
        
        const indexEl = item.querySelector('.video-index');
        indexEl.classList.toggle('playing', isActive);
        indexEl.textContent = isActive ? '‚ñ∂' : (shuffleEnabled ? 
          shuffledOrder.indexOf(idx) + 1 : idx + 1);
      });
    }

    // Scroll to current video
    function scrollToCurrentVideo() {
      const container = document.getElementById('playlist-videos');
      const activeItem = container.querySelector('.playlist-video-item.active');
      if (activeItem) {
        activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    // Shuffle playlist
    function shufflePlaylist() {
      if (!playlistData) return;
      
      shuffleEnabled = !shuffleEnabled;
      document.getElementById('shuffle-btn').classList.toggle('active', shuffleEnabled);
      
      if (shuffleEnabled) {
        // Fisher-Yates shuffle
        shuffledOrder = [...Array(playlistData.videos.length).keys()];
        for (let i = shuffledOrder.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffledOrder[i], shuffledOrder[j]] = [shuffledOrder[j], shuffledOrder[i]];
        }
        
        // Move current video to front
        const currentIdx = shuffledOrder.indexOf(currentPlaylistIndex);
        if (currentIdx > 0) {
          shuffledOrder.splice(currentIdx, 1);
          shuffledOrder.unshift(currentPlaylistIndex);
        }
        
        showToast('Shuffle enabled');
      } else {
        shuffledOrder = [...Array(playlistData.videos.length).keys()];
        showToast('Shuffle disabled');
      }
      
      renderPlaylistVideos();
      highlightCurrentVideo();
    }

    // Handle search
    async function handleSearch() {
      const input = document.getElementById('search-input').value.trim();
      if (!input) return;
      
      const playlistId = extractPlaylistId(input);
      const videoId = extractVideoId(input);
      
      if (playlistId) {
        const alsoHasVideo = videoId && !input.includes('playlist?');
        if (alsoHasVideo) {
          currentVideoId = videoId;
          initPlayer(videoId);
          loadVideoData(videoId);
        }
        loadPlaylist(playlistId, 0, !alsoHasVideo);
      } else if (videoId) {
        initPlayer(videoId);
        loadVideoData(videoId);
        updateURL(videoId);
        
        // Clear playlist
        playlistData = null;
        document.getElementById('playlist-panel').classList.add('hidden');
        document.getElementById('empty-state').classList.remove('hidden');
      } else {
        showToast('Please enter a valid YouTube video or playlist URL/ID');
      }
      
      document.getElementById('search-suggestions').classList.add('hidden');
    }

    // Paste from clipboard
    async function pasteFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('search-input').value = text;
        handleSearch();
      } catch (error) {
        showToast('Unable to access clipboard. Please paste manually.');
      }
    }

    // Clear playlist
    function clearPlaylist() {
      playlistData = null;
      currentPlaylistId = null;
      shuffledOrder = [];
      
      document.getElementById('playlist-panel').classList.add('hidden');
      document.getElementById('empty-state').classList.remove('hidden');
      
      if (currentVideoId) {
        updateURL(currentVideoId);
      }
      
      showToast('Playlist cleared');
    }

    // Setup event listeners
    function setupEventListeners() {
      // Search
      document.getElementById('search-btn').onclick = handleSearch;
      document.getElementById('search-input').onkeypress = (e) => {
        if (e.key === 'Enter') handleSearch();
      };
      
      // Search input focus
      document.getElementById('search-input').onfocus = () => {
        // Could show recent searches or suggestions
      };
      
      // Quick actions
      document.getElementById('paste-playlist-btn').onclick = pasteFromClipboard;
      document.getElementById('clear-playlist-btn').onclick = clearPlaylist;
      document.getElementById('shuffle-all-btn').onclick = shufflePlaylist;
      
      // Playlist controls
      document.getElementById('shuffle-btn').onclick = shufflePlaylist;
      
      document.getElementById('loop-toggle').onclick = function() {
        loopEnabled = !loopEnabled;
        this.classList.toggle('active', loopEnabled);
        showToast(loopEnabled ? 'Loop enabled' : 'Loop disabled');
      };
      
      document.getElementById('autoplay-toggle').onclick = function() {
        autoplayEnabled = !autoplayEnabled;
        this.classList.toggle('active', autoplayEnabled);
        showToast(autoplayEnabled ? 'Autoplay enabled' : 'Autoplay disabled');
      };
      
      // Autoplay overlay
      document.getElementById('play-now-btn').onclick = () => {
        const nextIndex = getNextVideoIndex();
        if (nextIndex !== null) {
          cancelAutoplayCountdown();
          playVideoFromPlaylist(nextIndex);
        }
      };
      
      document.getElementById('cancel-autoplay-btn').onclick = cancelAutoplayCountdown;
      
      // Description toggle
      document.getElementById('description-box').onclick = function() {
        const desc = document.getElementById('video-description');
        const toggle = document.getElementById('desc-toggle');
        
        if (!this.classList.contains('expanded')) {
          desc.classList.add('expanded');
          this.classList.add('expanded');
          toggle.textContent = 'Show less';
          toggle.classList.remove('hidden');
        }
      };
      
      document.getElementById('desc-toggle').onclick = function(e) {
        e.stopPropagation();
        const desc = document.getElementById('video-description');
        const box = document.getElementById('description-box');
        
        desc.classList.toggle('expanded');
        box.classList.toggle('expanded');
        this.textContent = desc.classList.contains('expanded') ? 'Show less' : 'Show more';
      };
      
      // Like button
      document.getElementById('like-btn').onclick = function() {
        this.classList.toggle('liked');
        showToast(this.classList.contains('liked') ? 'Added to liked videos' : 'Removed from liked videos');
      };
      
      // Subscribe button
      document.getElementById('subscribe-btn').onclick = function() {
        this.classList.toggle('subscribed');
        this.textContent = this.classList.contains('subscribed') ? 'Subscribed' : 'Subscribe';
        showToast(this.classList.contains('subscribed') ? 'Subscribed!' : 'Unsubscribed');
      };
      
      // Share button
      document.getElementById('share-btn').onclick = () => {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          showToast('Link copied to clipboard');
        }).catch(() => {
          showToast('Failed to copy link');
        });
      };
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Don't trigger if typing in input
        if (e.target.tagName === 'INPUT') return;
        
        switch(e.key) {
          case 'n':
          case 'N':
            if (e.shiftKey) playNextVideo();
            break;
          case 'p':
          case 'P':
            if (e.shiftKey) {
              const prevIndex = currentPlaylistIndex - 1;
              if (prevIndex >= 0) playVideoFromPlaylist(prevIndex);
            }
            break;
          case 's':
          case 'S':
            if (e.shiftKey) shufflePlaylist();
            break;
          case 'l':
          case 'L':
            if (e.shiftKey) {
              loopEnabled = !loopEnabled;
              document.getElementById('loop-toggle').classList.toggle('active', loopEnabled);
              showToast(loopEnabled ? 'Loop enabled' : 'Loop disabled');
            }
            break;
        }
      });
      
      // Browser back/forward
      window.addEventListener('popstate', () => {
        const params = getUrlParams();
        if (params.videoId && params.videoId !== currentVideoId) {
          if (player) {
            player.loadVideoById(params.videoId);
            currentVideoId = params.videoId;
            loadVideoData(params.videoId);
          }
          
          if (params.playlistId && params.playlistId === currentPlaylistId) {
            currentPlaylistIndex = params.index || 0;
            updatePlaylistProgress();
            highlightCurrentVideo();
          }
        }
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      setupEventListeners();
      
      // Check if YouTube API already loaded
      if (window.YT && window.YT.Player) {
        onYouTubeIframeAPIReady();
      }
    });
    
    // Fallback if API takes too long
    setTimeout(() => {
      if (!playerReady) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
      }
    }, 3000);
  </script>
</body>
</html>
